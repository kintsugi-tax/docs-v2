# Multiple MCP Servers Setup

This document explains how we've configured three separate MCP servers for different audiences.

## Overview

We now have **three MCP servers** serving different API endpoint sets:

1. **`/mcp-public`** - Customer API endpoints (publicly available)
2. **`/mcp-partners`** - Public Partners API endpoints (only those listed in "API Reference - Partners")
3. **`/mcp-internal`** - All Partners API endpoints (internal/full spec)

## MCP Server Details

### `/mcp-public`
- **Source**: `openapi.json` (Customer API)
- **URL**: `https://api-doc.trykintsugi.com/openapi.json`
- **Endpoints**: ~28 Customer API endpoints
- **Audience**: Public users
- **Configuration**: Auto-downloaded and MCP-enabled in workflow

### `/mcp-partners`
- **Source**: `openapi-partners-public.json` (filtered Partners API)
- **Filtering**: Only endpoints listed in "API Reference - Partners" section of `docs.json`
- **Endpoints**: ~51 public Partners API endpoints (72 pages → 51 unique paths)
- **Audience**: Partners who need public API access
- **Configuration**: Generated by `extract-public-partners-endpoints.py` script

### `/mcp-internal`
- **Source**: `openapi-partners.json` (full Partners API)
- **URL**: `https://api.trykintsugi.com/openapi.json`
- **Endpoints**: ~274 Partners API endpoints (all internal endpoints)
- **Audience**: Internal use, full API access
- **Configuration**: Auto-downloaded and MCP-enabled in workflow

## File Structure

```
docs-v2/
├── openapi.json                          # Customer API → /mcp-public
├── openapi-partners.json                 # Full Partners API → /mcp-internal
├── openapi-partners-public.json          # Filtered Partners API → /mcp-partners
├── docs.json                             # Configuration with 3 OpenAPI entries
└── scripts/
    ├── setup-mcp-servers.sh              # Main setup script
    ├── extract-public-partners-endpoints.py  # Filters public endpoints
    └── add-mcp-config-to-endpoints.sh    # Adds MCP config to endpoints
```

## How It Works

### 1. Public Endpoints Extraction

The `extract-public-partners-endpoints.py` script:
- Reads `docs.json` to find all pages in "API Reference - Partners"
- Parses MDX files to extract OpenAPI paths (e.g., `post /v1/transactions`)
- Filters `openapi-partners.json` to only include those endpoints
- Adds MCP configuration to the filtered spec

### 2. MCP Configuration

Each OpenAPI file has:
- Root-level: `x-mint.mcp.enabled: true`
- Endpoint-level: Each operation has `x-mint.mcp.enabled: true`

### 3. Docs.json Configuration

```json
{
  "openapi": [
    {
      "url": "./openapi.json",
      "label": "Customer API",
      "mcp": {
        "path": "/mcp-public"
      }
    },
    {
      "url": "./openapi-partners-public.json",
      "label": "Partners API (Public)",
      "mcp": {
        "path": "/mcp-partners"
      }
    },
    {
      "url": "./openapi-partners.json",
      "label": "Partners API (Internal)",
      "mcp": {
        "path": "/mcp-internal"
      }
    }
  ]
}
```

## Automatic Updates

The GitHub Actions workflow (`.github/workflows/update-api-docs.yml`) automatically:
1. Downloads Customer API spec → `openapi.json`
2. Downloads Partners API spec → `openapi-partners.json`
3. Adds MCP configuration to both
4. Generates filtered Partners API spec → `openapi-partners-public.json`
5. Commits and deploys all three files

## Manual Setup

To set up locally:

```bash
# Run the setup script
./scripts/setup-mcp-servers.sh

# Or manually:
# 1. Download Customer API
curl https://api-doc.trykintsugi.com/openapi.json -o openapi.json
./scripts/add-mcp-config-to-endpoints.sh openapi.json

# 2. Download Partners API
curl https://api.trykintsugi.com/openapi.json -o openapi-partners.json
./scripts/add-mcp-config-to-endpoints.sh openapi-partners.json

# 3. Generate filtered Partners API
python3 scripts/extract-public-partners-endpoints.py
```

## Accessing MCP Servers

Once deployed, the MCP servers **should** be available at:
- `https://kintsugi.mintlify.app/mcp-public` (Customer API)
- `https://kintsugi.mintlify.app/mcp-partners` (Public Partners API)
- `https://kintsugi.mintlify.app/mcp-internal` (Internal Partners API)

**Important Note**: Mintlify may not support custom `mcp.path` configuration in `docs.json`. If the custom paths don't work, Mintlify will likely generate MCP servers at:
- `/mcp` (first OpenAPI file - Customer API)
- `/mcp-1` (second OpenAPI file - Partners Public)
- `/mcp-2` (third OpenAPI file - Partners Internal)

**To verify actual paths**:
1. Check Mintlify dashboard → Products → MCP Server
2. Look for all available MCP servers and their paths
3. Update this documentation with the actual paths if different

**If custom paths are needed**, you may need to:
- Contact Mintlify support to request custom MCP server path support
- Or reorganize the OpenAPI files in `docs.json` to match desired order

## Troubleshooting

### MCP Servers Not Showing

1. **Check deployment**: Ensure all three OpenAPI files are committed
2. **Verify MCP config**: Check that each file has `x-mint.mcp.enabled: true`
3. **Manual update**: Trigger manual update in Mintlify dashboard
4. **Check paths**: Verify actual MCP server paths in Mintlify dashboard

### Public Endpoints Missing

If `/mcp-partners` is missing endpoints:
1. Check `docs.json` - ensure endpoint is listed in "API Reference - Partners"
2. Verify MDX file exists: `reference/partners/{category}/{endpoint}.mdx`
3. Check MDX frontmatter: Should have `openapi: {method} {path}`
4. Re-run `extract-public-partners-endpoints.py`

## References

- [Mintlify MCP Documentation](https://www.mintlify.com/docs/ai/model-context-protocol)
- Customer API: https://api-doc.trykintsugi.com/openapi.json
- Partners API: https://api.trykintsugi.com/openapi.json

